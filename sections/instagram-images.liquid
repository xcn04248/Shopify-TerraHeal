{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Header Bar */
  .instagram-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .instagram-header__title {
    font-size: {{ section.settings.title_font_size }}px;
    color: {{ section.settings.title_color }};
    font-weight: {{ section.settings.title_font_weight }};
    margin: 0;
  }

  .instagram-header__account {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .instagram-icon--color {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
  }

  .instagram-account__info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .instagram-account__name {
    font-size: {{ section.settings.account_font_size }}px;
    color: {{ section.settings.account_color }};
    font-weight: {{ section.settings.account_font_weight }};
    line-height: 1;
  }

  .instagram-follow-btn {
    display: inline-block;
    padding: 6px 16px;
    background: {{ section.settings.follow_bg_color }};
    color: {{ section.settings.follow_text_color }};
    border: 2px solid {{ section.settings.follow_border_color }};
    border-radius: {{ section.settings.follow_border_radius }}px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    line-height: 1;
  }

  .instagram-follow-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Image Card */
  .instagram-image-card {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    aspect-ratio: {{ section.settings.image_ratio }};
  }

  .instagram-image-card__link {
    display: block;
    position: relative;
    width: 100%;
    height: 100%;
  }

  .instagram-image-card__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .instagram-image-card__overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0);
    transition: background 0.3s ease;
  }

  .instagram-image-card:hover .instagram-image-card__overlay {
    background: rgba(0, 0, 0, 0.1);
  }

  /* Instagram Icon on Image */
  .instagram-icon-overlay {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 32px;
    height: 32px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 2;
  }

  .instagram-image-card:hover .instagram-icon-overlay {
    opacity: 1;
  }

  .instagram-icon-overlay svg {
    width: 20px;
    height: 20px;
  }

  /* Product Links */
  .instagram-products {
    position: absolute;
    bottom: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    gap: {{ section.settings.product_spacing }}px;
    z-index: 2;
  }

  .instagram-product {
    width: {{ section.settings.product_size }}px;
    height: {{ section.settings.product_size }}px;
    border-radius: {{ section.settings.product_border_radius }}px;
    overflow: hidden;
    border: {{ section.settings.product_border_width }}px solid {{ section.settings.product_border_color }};
    background: #fff;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    flex-shrink: 0;
  }

  .instagram-product:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .instagram-product img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  @media screen and (max-width: 749px) {
    .instagram-header__title {
      font-size: calc({{ section.settings.title_font_size }}px * 0.85);
    }

    .instagram-account__name {
      font-size: calc({{ section.settings.account_font_size }}px * 0.9);
    }

    .instagram-icon--color {
      width: 32px;
      height: 32px;
    }

    .instagram-products {
      gap: {{ section.settings.product_spacing | divided_by: 2 }}px;
    }

    .instagram-product {
      width: calc({{ section.settings.product_size }}px * 0.8);
      height: calc({{ section.settings.product_size }}px * 0.8);
    }
  }
{%- endstyle -%}

<div class="instagram-section section-{{ section.id }}-padding {{ section.settings.visibility }}">
  <div class="page-width">
    {%- if section.settings.title != blank or section.settings.instagram_handle != blank -%}
      <div class="instagram-header">
        {%- if section.settings.title != blank -%}
          <h2 class="instagram-header__title">{{ section.settings.title }}</h2>
        {%- endif -%}
        
        {%- if section.settings.instagram_handle != blank -%}
          <div class="instagram-header__account">
            <svg class="instagram-icon--color" viewBox="0 0 24 24" fill="url(#instagram-gradient)">
              <defs>
                <linearGradient id="instagram-gradient" x1="0%" y1="100%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#FED576;stop-opacity:1" />
                  <stop offset="25%" style="stop-color:#F47133;stop-opacity:1" />
                  <stop offset="50%" style="stop-color:#BC3081;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#4C63D2;stop-opacity:1" />
                </linearGradient>
              </defs>
              <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
            </svg>
            <div class="instagram-account__info">
              <div class="instagram-account__name">{{ section.settings.instagram_handle }}</div>
              {%- if section.settings.instagram_url != blank -%}
                <a href="{{ section.settings.instagram_url }}" target="_blank" rel="noopener" class="instagram-follow-btn">
                  Follow
                </a>
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <splide-component
        data-type="{{ section.settings.slider_type }}"
        data-autoplay="{{ section.settings.autoplay }}"
        data-autoplay-speed="{{ section.settings.autoplay_speed }}"
        data-slides-desktop="{{ section.settings.desktop_slides }}"
        data-per-move-desktop="1"
        data-gap-desktop="{{ section.settings.desktop_spacing }}"
        data-slides-mobile="{{ section.settings.mobile_slides }}"
        data-gap-mobile="{{ section.settings.mobile_spacing }}"
        data-side-padding-mobile="15"
      >
        <div class="splide splide--desktop-dots-{{ section.settings.desktop_dots_position }} splide--desktop-arrows-{{ section.settings.desktop_arrows_position }} splide--desktop-arrows-outside">
          <div class="splide__track">
            <ul class="splide__list">
              {%- for block in section.blocks -%}
                <li class="splide__slide" {{ block.shopify_attributes }}>
                  <div class="instagram-image-card">
                    <a href="{{ block.settings.image_link | default: '#' }}" class="instagram-image-card__link" {% if block.settings.image_link == blank %}onclick="return false;"{% endif %}>
                      {%- if block.settings.image != blank -%}
                        {{
                          block.settings.image
                          | image_url: width: 800
                          | image_tag:
                            loading: 'lazy',
                            sizes: '(min-width: 990px) 300px, (min-width: 750px) 250px, calc(100vw - 30px)',
                            widths: '200, 300, 400, 500, 600, 800',
                            class: 'instagram-image-card__img'
                        }}
                      {%- else -%}
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); display: flex; align-items: center; justify-content: center; color: #999;">
                          No Image
                        </div>
                      {%- endif -%}
                      
                      <div class="instagram-image-card__overlay"></div>
                      
                      <div class="instagram-icon-overlay">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                          <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                          <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                        </svg>
                      </div>

                      {%- assign has_products = false -%}
                      {%- if block.settings.product_1 != blank or block.settings.product_2 != blank or block.settings.product_3 != blank or block.settings.product_4 != blank or block.settings.product_5 != blank -%}
                        {%- assign has_products = true -%}
                      {%- endif -%}

                      {%- if has_products -%}
                        <div class="instagram-products">
                          {%- if block.settings.product_1 != blank -%}
                            <a href="{{ block.settings.product_1.url }}" class="instagram-product">
                              {%- if block.settings.product_1.featured_image -%}
                                <img src="{{ block.settings.product_1.featured_image | image_url: width: 200 }}" alt="{{ block.settings.product_1.title }}" loading="lazy">
                              {%- endif -%}
                            </a>
                          {%- endif -%}
                          {%- if block.settings.product_2 != blank -%}
                            <a href="{{ block.settings.product_2.url }}" class="instagram-product">
                              {%- if block.settings.product_2.featured_image -%}
                                <img src="{{ block.settings.product_2.featured_image | image_url: width: 200 }}" alt="{{ block.settings.product_2.title }}" loading="lazy">
                              {%- endif -%}
                            </a>
                          {%- endif -%}
                          {%- if block.settings.product_3 != blank -%}
                            <a href="{{ block.settings.product_3.url }}" class="instagram-product">
                              {%- if block.settings.product_3.featured_image -%}
                                <img src="{{ block.settings.product_3.featured_image | image_url: width: 200 }}" alt="{{ block.settings.product_3.title }}" loading="lazy">
                              {%- endif -%}
                            </a>
                          {%- endif -%}
                          {%- if block.settings.product_4 != blank -%}
                            <a href="{{ block.settings.product_4.url }}" class="instagram-product">
                              {%- if block.settings.product_4.featured_image -%}
                                <img src="{{ block.settings.product_4.featured_image | image_url: width: 200 }}" alt="{{ block.settings.product_4.title }}" loading="lazy">
                              {%- endif -%}
                            </a>
                          {%- endif -%}
                          {%- if block.settings.product_5 != blank -%}
                            <a href="{{ block.settings.product_5.url }}" class="instagram-product">
                              {%- if block.settings.product_5.featured_image -%}
                                <img src="{{ block.settings.product_5.featured_image | image_url: width: 200 }}" alt="{{ block.settings.product_5.title }}" loading="lazy">
                              {%- endif -%}
                            </a>
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    </a>
                  </div>
                </li>
              {%- endfor -%}
            </ul>
          </div>
          <div class="splide__dots-and-arrows">
            <ul class="splide__pagination"></ul>
            <div class="splide__arrows"></div>
          </div>
        </div>
      </splide-component>
    {%- else -%}
      <div style="text-align: center; padding: 60px 20px; color: #999;">
        <p>Add image blocks to display Instagram images.</p>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Instagram Images",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "visibility",
      "options": [
        {
          "value": "desktop-hidden",
          "label": "Mobile only"
        },
        {
          "value": "mobile-hidden",
          "label": "Desktop only"
        },
        {
          "value": "always-display",
          "label": "All devices"
        }
      ],
      "label": "Display on",
      "default": "always-display"
    },
    {
      "type": "header",
      "content": "Title Settings"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Follow Us on Instagram"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 18,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32,
      "label": "Title font size"
    },
    {
      "type": "color",
      "id": "title_color",
      "default": "#000000",
      "label": "Title color"
    },
    {
      "type": "select",
      "id": "title_font_weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "700",
      "label": "Title font weight"
    },
    {
      "type": "header",
      "content": "Instagram Account"
    },
    {
      "type": "text",
      "id": "instagram_handle",
      "label": "Instagram handle",
      "default": "@yourbrand",
      "info": "Include the @ symbol"
    },
    {
      "type": "url",
      "id": "instagram_url",
      "label": "Instagram profile URL",
      "info": "Full URL to your Instagram profile"
    },
    {
      "type": "range",
      "id": "account_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16,
      "label": "Account name font size"
    },
    {
      "type": "color",
      "id": "account_color",
      "default": "#000000",
      "label": "Account name color"
    },
    {
      "type": "select",
      "id": "account_font_weight",
      "options": [
        {
          "value": "300",
          "label": "Light"
        },
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semi-bold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "600",
      "label": "Account name font weight"
    },
    {
      "type": "header",
      "content": "Follow Button"
    },
    {
      "type": "color",
      "id": "follow_bg_color",
      "default": "#ffffff",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "follow_text_color",
      "default": "#000000",
      "label": "Text color"
    },
    {
      "type": "color",
      "id": "follow_border_color",
      "default": "#000000",
      "label": "Border color"
    },
    {
      "type": "range",
      "id": "follow_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 8,
      "label": "Border radius"
    },
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "1 / 1",
          "label": "Square (1:1)"
        },
        {
          "value": "3 / 4",
          "label": "Portrait (3:4)"
        },
        {
          "value": "4 / 3",
          "label": "Landscape (4:3)"
        },
        {
          "value": "auto",
          "label": "Original"
        }
      ],
      "default": "1 / 1",
      "label": "Image aspect ratio"
    },
    {
      "type": "header",
      "content": "Product Links"
    },
    {
      "type": "range",
      "id": "product_size",
      "min": 30,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 50,
      "label": "Product image size"
    },
    {
      "type": "range",
      "id": "product_spacing",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 8,
      "label": "Space between products"
    },
    {
      "type": "range",
      "id": "product_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "default": 6,
      "label": "Product border radius"
    },
    {
      "type": "range",
      "id": "product_border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "default": 2,
      "label": "Product border width"
    },
    {
      "type": "color",
      "id": "product_border_color",
      "default": "#ffffff",
      "label": "Product border color"
    },
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "select",
      "id": "slider_type",
      "options": [
        {
          "value": "slide",
          "label": "Classic"
        },
        {
          "value": "loop",
          "label": "Infinite loop"
        }
      ],
      "default": "loop",
      "label": "Slider type"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 1,
      "max": 15,
      "step": 0.5,
      "default": 5,
      "unit": "sec",
      "label": "Autoplay speed"
    },
    {
      "type": "select",
      "id": "desktop_arrows_position",
      "options": [
        {
          "value": "sides",
          "label": "On sides"
        },
        {
          "value": "under",
          "label": "Under slider"
        },
        {
          "value": "hidden",
          "label": "Hidden"
        }
      ],
      "default": "sides",
      "label": "Desktop arrows position"
    },
    {
      "type": "select",
      "id": "desktop_dots_position",
      "options": [
        {
          "value": "under",
          "label": "Under slider"
        },
        {
          "value": "hidden",
          "label": "Hidden"
        }
      ],
      "default": "under",
      "label": "Desktop dots position"
    },
    {
      "type": "header",
      "content": "Desktop Layout"
    },
    {
      "type": "text",
      "id": "desktop_slides",
      "label": "Number of slides to show",
      "default": "4.5",
      "info": "Use decimals for partial slides (e.g., 4.5 shows 4 full + half of next)"
    },
    {
      "type": "range",
      "id": "desktop_spacing",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20,
      "label": "Space between images"
    },
    {
      "type": "header",
      "content": "Mobile Layout"
    },
    {
      "type": "text",
      "id": "mobile_slides",
      "label": "Number of slides to show",
      "default": "1.5",
      "info": "Use decimals for partial slides (e.g., 1.5 shows 1 full + half of next)"
    },
    {
      "type": "range",
      "id": "mobile_spacing",
      "min": 0,
      "max": 30,
      "step": 5,
      "unit": "px",
      "default": 15,
      "label": "Space between images"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Instagram Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Image link (optional)",
          "info": "Link when clicking the image"
        },
        {
          "type": "header",
          "content": "Related Products"
        },
        {
          "type": "product",
          "id": "product_1",
          "label": "Product 1"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product 2"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product 3"
        },
        {
          "type": "product",
          "id": "product_4",
          "label": "Product 4"
        },
        {
          "type": "product",
          "id": "product_5",
          "label": "Product 5"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Instagram Images",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
